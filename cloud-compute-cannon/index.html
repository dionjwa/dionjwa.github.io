<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Archived/cloud-compute-cannon">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Cloud Compute Cannon | Dion Whitehead</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://evolvedeeptimecomplex.systems/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://evolvedeeptimecomplex.systems/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://evolvedeeptimecomplex.systems/cloud-compute-cannon"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="metapages, docker, justfile, mermaid, deno, whales, cetaceans, simulations, evolution, superslides, gestures, hand control, deep time"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cloud Compute Cannon | Dion Whitehead"><meta data-rh="true" name="description" content="This was in 2017 at Autodesk Bionano (→ Autodesk Lifesciences → shutdown), despite the date listed. This is more to record that I have been thinking and building on convenient, easy-access, standardized scalable compute for science for a while."><meta data-rh="true" property="og:description" content="This was in 2017 at Autodesk Bionano (→ Autodesk Lifesciences → shutdown), despite the date listed. This is more to record that I have been thinking and building on convenient, easy-access, standardized scalable compute for science for a while."><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://evolvedeeptimecomplex.systems/cloud-compute-cannon"><link data-rh="true" rel="alternate" href="https://evolvedeeptimecomplex.systems/cloud-compute-cannon" hreflang="en"><link data-rh="true" rel="alternate" href="https://evolvedeeptimecomplex.systems/cloud-compute-cannon" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Dion Whitehead RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Dion Whitehead Atom Feed"><link rel="stylesheet" href="/assets/css/styles.76cd2ca9.css">
<link rel="preload" href="/assets/js/runtime~main.8c2797d1.js" as="script">
<link rel="preload" href="/assets/js/main.ea297f13.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_ncxO" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo.svg" alt="Logo" class="themedImage_GG80 themedImage--light_ZgxF"><img src="/logo.svg" alt="Logo" class="themedImage_GG80 themedImage--dark_MYOw"></div><b class="navbar__title text--truncate">Idea Sets</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/resume">Resume</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dionjwa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_EDmP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_nHBA colorModeToggle_jEoN"><button class="clean-btn toggleButton_gmen toggleButtonDisabled_Zoqn" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_vSGv"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_JP4D"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_tp3Z"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_fl_v docsWrapper_ytDb"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_fFhq" type="button"></button><div class="docPage_WdUH"><aside class="theme-doc-sidebar-container docSidebarContainer_z7_f"><div class="sidebarViewport_Rl5r"><div class="sidebar_V2Af"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_FhEl"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Who I am</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/url-configured-websites">Technical</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cloud-compute-cannon">Archived</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cloud-compute-cannon">Cloud Compute Cannon</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/resume">Resume List</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_Pgl4"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_rctn"><div class="docItemContainer_dEmd"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z9gU" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_vGxT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Archived</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cloud Compute Cannon</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ZGGv theme-doc-toc-mobile tocMobile_bAIR"><button type="button" class="clean-btn tocCollapsibleButton_VzJ9">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cloud Compute Cannon</h1></header><blockquote><p>This was in 2017 at Autodesk Bionano (→ Autodesk Lifesciences → <code>shutdown</code>), despite the date listed. This is more to record that I have been thinking and building on convenient, easy-access, standardized scalable compute for science for a while.</p></blockquote><blockquote><p>Apart from the first paragraph, the rest is not applicable anymore, and the system is shelved.</p></blockquote><p>The <a href="http://bionano.autodesk.com/" target="_blank" rel="noopener noreferrer">Bionano research group</a> at Autodesk needed an open source tool for performing scalable computes (e.g. molecular simulations) in the cloud. The problem it solves is <em>&quot;I want to run 1000 simulations and get the results quickly, and I don&#x27;t have access to a high performance cluster (or I don&#x27;t know how to use the cluster)&quot;</em>. We built <a href="https://github.com/Autodesk/cloudcomputecannon/" target="_blank" rel="noopener noreferrer">cloud-compute-cannon</a> (CCC) for this. This blog describes some of the technology behind it.</p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="9c785c4f6b12478e978456f62b685acb">Architecture and technical decisions<a href="#9c785c4f6b12478e978456f62b685acb" class="hash-link" aria-label="Direct link to Architecture and technical decisions" title="Direct link to Architecture and technical decisions">​</a></h3><p>Cloud-compute-cannon is a client/server application. The server is installed on the users cloud (or their local machine) and creates workers to perform compute jobs. The server needs to:</p><ul><li>Install locally and on cloud providers (e.g. AWS or GCE via their SDKs)</li><li>Interact with Docker daemons via the remote API</li><li>Interact with remote machines via SSH</li><li>Talk to a database (that stores state)</li><li>Interact with a thin CLI client</li><li>Potentially other, as yet unknown, requirements</li></ul><p>Instead of worker machines pulling jobs from a queue, CCC works by pushing jobs to workers. The disadvantage with this approach is that if the servers goes down, the system stops working. The advantage is that the workers are extremely dumb: they are just bare CoreOS machines with nothing extra installed. Node.js can easily monitor many many workers in case they go down. By making the workers dumb, there is a single place for upgrading the system (simplicity was a goal here).</p><p><img loading="lazy" src="/assets/images/743181975-781c9e1ed506f9ac547dcffa4db16ac9.png" width="598" height="357" class="img_mf7_"></p><p>Node.js was a pretty easy choice for the server because of the large third party library support. Redis was chosen for the database because its simplicity and crucially, it had scripting support. Scripting means no concurrency issues as redis lua scripts block other requests.</p><p>The added advantage of Node.js was using the same codebase for the client and server.</p><p>However, instead of writing Javascript, it was built in Haxe.</p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="29a6769c7e97428a9ac8af8ed423ea0f">What is <a href="https://haxe.org/#learn-more/" target="_blank" rel="noopener noreferrer">Haxe</a>?<a href="#29a6769c7e97428a9ac8af8ed423ea0f" class="hash-link" aria-label="Direct link to 29a6769c7e97428a9ac8af8ed423ea0f" title="Direct link to 29a6769c7e97428a9ac8af8ed423ea0f">​</a></h3><p><a href="https://haxe.org/#learn-more/" target="_blank" rel="noopener noreferrer">Haxe</a> is an open source language and toolkit. The language is inspired from Javascript and Actionscript (Flash). The Haxe toolkit has <em>multiple compilers</em>, meaning you write in one language, and you export directly to multiple languages:</p><p>Currently, Haxe compiles to the following targets:</p><p><img loading="lazy" alt="https://haxe.org/documentation/introduction/compiler-targets.html" src="/assets/images/850217860-e61e09655e7c5c226cb7da8f721254bd.png" width="1618" height="1334" class="img_mf7_"></p><p>For this project though, we&#x27;re using just the Javascript compiler. Why Haxe and not e.g. Coffeescript or Typescript (or plain Javascript)? A more detailed answer is provided by <a href="http://blog.onthewings.net/2015/08/05/typescript-vs-haxe/" target="_blank" rel="noopener noreferrer">Andy Li</a>, but in short: Haxe provides far more useful language features, and it is more mature, and has compile time type checking that is invaluable in large code-bases. It has the added bonus that we could build multiple clients in different languages (e.g. Python or native binaries) if needed (the server would be more difficult due to the reliance on third party libraries).</p><p>Although Haxe has many <a href="http://haxe.org/manual/lf.html" target="_blank" rel="noopener noreferrer">very useful language features</a>, the features most important to this project are:</p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="efe9c56b642e42e3a9345cc92653e527">1) Compile time typing<a href="#efe9c56b642e42e3a9345cc92653e527" class="hash-link" aria-label="Direct link to 1) Compile time typing" title="Direct link to 1) Compile time typing">​</a></h3><p>Functions, collections, and variables are <em>typed</em>, and checked at compile time. For example, the compiler will prevent you from calling a function with an Int argument when it&#x27;s expecting an array. For a large-ish codebase of a cloud application this is crucial, as it reduces the number of bugs that make it into functional testing (and functional testing scalable cloud applications is <em>very</em> time consuming).</p><p>Javascript code. Note you can call a function with whatever arguments you like:</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//Somewhere else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//This is correct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;somestring&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//Legal, although bad.</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In Haxe, you cannot compile with the last line. The compiler has caught a mistake the developer wrote.</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//Haxe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">input</span><span class="token parameter"> </span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter maybe-class-name">Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Int</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Somewhere else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//This is correct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> result2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doAThing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;somestring&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//Compile error!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_FJPA" id="856c6b2496904f3195522a9b7bd53c3d">2) Macros<a href="#856c6b2496904f3195522a9b7bd53c3d" class="hash-link" aria-label="Direct link to 2) Macros" title="Direct link to 2) Macros">​</a></h3><p>Haxe macros are incredibly powerful, and the full capabilities are beyond the scope of this blog post. For this project they automatically generate bindings between the CLI client and the server.</p><p>On the server, there are &#x27;services&#x27; where the methods correspond to RPC (remote procedure calls), where the <strong>@rpc</strong> decorator marks it as a remote API endpoint:</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ServiceBatchCompute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Server method for an API endpoint:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @</span><span class="token function" style="color:#d73a49">rpc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">alias</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;jobs&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">doc</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;List all job ids&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">jobs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token known-class-name class-name">Promise</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">JobId</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">ComputeQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getAllJobIds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_redis</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the client</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//Server methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> defs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Macros</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getMethodDefinitions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">ServiceBatchCompute</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">def </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> defs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">CommanderTools</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">program</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> def</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above code generates (at compile time) a function that creates a <a href="https://en.wikipedia.org/wiki/JSON-RPC" target="_blank" rel="noopener noreferrer">JSON-RPC</a> call to the remote server if the CLI command is called. E.g. calling the CLI client with the <strong>jobs</strong> sub-command:</p><div class="language-shell codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-shell codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token plain">ccc </span><span class="token function" style="color:#d73a49">jobs</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>creates the following JSON and sends it to the server (via http):</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">jsonrpc</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;2.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jobs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">params</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The server maps the call to the correct function, calls the function, then sends the result back in the HTTP response. The CLI interacts with the server API, but it could easily be another server.</p><p>The important point is that new services have the corresponding CLI client commands <em>automatically</em> generated. There is no need to touch the client code ever again, and there is no chance that a typo will accidentally break client-server communication.</p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="c82fb9fb390144bca575dfc8f12c6551">3) Code completion<a href="#c82fb9fb390144bca575dfc8f12c6551" class="hash-link" aria-label="Direct link to 3) Code completion" title="Direct link to 3) Code completion">​</a></h3><p>I just really like code completion. Code completion is handled by the Haxe compiler, so all text editors and IDEs can easily add sophisticated code completion.</p><p><img loading="lazy" src="data:image/png;base64,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" width="334" height="156" class="img_mf7_"></p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="4bb9b6ad68d04f49a1e1d7611abcba8d">4) Abstracts<a href="#4bb9b6ad68d04f49a1e1d7611abcba8d" class="hash-link" aria-label="Direct link to 4) Abstracts" title="Direct link to 4) Abstracts">​</a></h3><p>These are classes and data structures that do not exist at run-time, only at compile time. In Cloud-compute-cannon, they are used to maintain specific compile-checked enum types between the server and the database scripts.</p><p>The redis scripts are in Lua, which is a new Haxe target! However the Lua target is not yet mature, so the database scripts are written manually, and embedded as raw strings in Haxe classes. This has the advantage of some compile time checking of constants and abstract types.</p><p>The following is a <a href="http://haxe.org/manual/types-abstract-enum.html" target="_blank" rel="noopener noreferrer">Haxe abstract enum</a>. It only exists at compile time, at runtime the values are just strings.</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token plain">@</span><span class="token operator" style="color:#393A34">:</span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abstract </span><span class="token function maybe-class-name" style="color:#d73a49">JobStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Pending</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pending&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Working</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;working&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Finalizing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;finalizing&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Finished</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;finished&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, the values can be embedded in a Lua script:</p><div class="language-lua codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-lua codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token plain">local status = &quot;${JobStatus.Pending}&quot;</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And this Lua script is embedded in a Haxe class (this example is contrived for simplicity):</p><div class="language-javascript codeBlockContainer_xNQZ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_rwCy"><pre tabindex="0" class="prism-code language-javascript codeBlock_vNka thin-scrollbar"><code class="codeBlockLines_ViEm"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> script </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;local status = &quot;${JobStatus.Pending}&quot;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_s1c6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_J45_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_zYXV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ylf7"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then if we change the JobStatus abstract, all the values are compile time checked. This means that it is impossible for a simple typo in a string value to result in a value being sent between the server and the database.</p><p>When the Lua target stabilizes, the scripts may get written in Haxe and compiled. This would allow better code re-use, and allow compile-time checking of the actual types and objects being created, stored, and send from within the database.</p><h3 class="anchor anchorWithStickyNavbar_FJPA" id="84f4acf04a7f43eba3481ae98c1cfa96">Conclusion<a href="#84f4acf04a7f43eba3481ae98c1cfa96" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3><p>This demonstrates some of the power that the Haxe toolkit provides:</p><ul><li>Flexibility: write code for multiple platforms without losing the power of a compiler.</li><li>Future proofing: as new platforms become available, the Haxe toolkit can target them.</li><li>More robust code: compiler prevent simple errors, and make maintenance (e.g. refactoring) of large code bases much easier.</li><li>Performance: function inline may not available on the target platform itself (e.g. Javascript in Node.js).</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/how-this-blog-is-automated"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How this blog is automated</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/resume"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Resume</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_WyRm thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#9c785c4f6b12478e978456f62b685acb" class="table-of-contents__link toc-highlight">Architecture and technical decisions</a></li><li><a href="#29a6769c7e97428a9ac8af8ed423ea0f" class="table-of-contents__link toc-highlight">What is Haxe?</a></li><li><a href="#efe9c56b642e42e3a9345cc92653e527" class="table-of-contents__link toc-highlight">1) Compile time typing</a></li><li><a href="#856c6b2496904f3195522a9b7bd53c3d" class="table-of-contents__link toc-highlight">2) Macros</a></li><li><a href="#c82fb9fb390144bca575dfc8f12c6551" class="table-of-contents__link toc-highlight">3) Code completion</a></li><li><a href="#4bb9b6ad68d04f49a1e1d7611abcba8d" class="table-of-contents__link toc-highlight">4) Abstracts</a></li><li><a href="#84f4acf04a7f43eba3481ae98c1cfa96" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 metapages, LLC. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8c2797d1.js"></script>
<script src="/assets/js/main.ea297f13.js"></script>
</body>
</html>